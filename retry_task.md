# 重试任务分解

## 1. 前端实现

### 1.1. UI 更改 (历史记录页面)
    - [x] 在作业列表中识别失败的作业。
    - [x] 在操作列中，为失败的作业有条件地渲染一个"重试"按钮。
    - [x] 确保按钮视觉上清晰且易于用户操作。

### 1.2. API 集成
    - [x] 定义重试 API 的请求负载 (例如，作业 ID)。
    - [x] 实现一个函数来调用后端重试 API。
    - [x] 处理 API 响应 (成功/失败) 并向用户提供反馈 (例如，toast 通知)。
    - [x] 重试成功启动后，可能需要在 UI 中更新作业状态。
    - [x] 重试成功时清除错误消息显示。

## 2. 后端实现

### 2.1. API 端点
    - [x] 创建一个新的 API 路由 (例如，`POST /api/jobs/{job_id}/retry`)。
    - [x] 验证请求 (例如，确保 `job_id` 有效并且作业确实处于失败状态)。

### 2.2. 重试逻辑
    - [x] 使用 `job_id` 从数据库中获取作业详细信息。
    - [x] 确定作业失败的当前阶段/步骤。
    - [x] 实现从失败步骤恢复作业的逻辑。这可能涉及：
        - 重新将作业加入队列。
        - 重新执行特定的函数或服务。
    - [x] 更新数据库中的作业状态 (例如，更新为 'pending' 或 'retrying')。
    - [x] 处理重试过程中的潜在错误。
    - [x] 重试成功时清除数据库中的错误消息。

## 3. 数据库注意事项 (如果有)
    - [ ] 审查是否需要更改数据库表结构以支持重试 (例如，增加重试次数字段，或者如果尚未完成，则更明确地存储上次失败原因)。(初期可能不需要，但值得考虑)。

## 4. 测试
    - [ ] 后端重试逻辑的单元测试。
    - [ ] 前后端重试流程的集成测试。
    - [ ] 针对各种失败场景，对 UI 和重试功能进行手动测试。

## 5. 部署
    - [ ] 确保新的 API 端点包含在部署脚本/配置中。
    - [ ] 更新所有相关文档。 